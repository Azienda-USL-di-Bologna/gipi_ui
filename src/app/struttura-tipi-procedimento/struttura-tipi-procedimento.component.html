<div id="page">
  <dx-responsive-box singleColumnScreen="sm" [(screenByWidth)]="screen">

    <dxi-row [ratio]="2"></dxi-row>
    <dxi-row [ratio]="2" screen="xs"></dxi-row>
    <dxi-row [ratio]="7"></dxi-row>
    <dxi-row [ratio]="2"></dxi-row>

    <dxi-col [ratio]="1"></dxi-col>
    <dxi-col [ratio]="2" screen="lg"></dxi-col>
    <dxi-col [ratio]="1"></dxi-col>

    <dxi-item>
      <dxi-location [row]="0" [col]="0" [colspan]="3" screen="lg"></dxi-location>
      <dxi-location [row]="0" [col]="0" [colspan]="2" screen="sm"></dxi-location>

      <div class = "header item">
        <h3>
          <span class="header-font">Tipo procedimento:</span>
          <i>{{headerTipoProcedimento}}</i>
        </h3>
        <h3>
          <span class="header-font">Azienda:</span>
          <i>{{headerAzienda}}</i>
        </h3>
        <h3>
            <span class="header-font">Struttura:</span>
            <i>{{headerStruttura}}</i>
          </h3>
      </div>
    </dxi-item>

    <dxi-item>
      <dxi-location [row]="1" [col]="1" screen="lg"></dxi-location>
      <dxi-location [row]="1" [col]="0" [colspan]="2" screen="sm"></dxi-location>

      <div class="center-div" id="center-div">
        <dx-form id="form" #myform [(formData)]="procedimento" [visible]="formVisible">  <!-- [readOnly]="readOnly" [showColonAfterLabel]="showColon" [labelLocation]="labelLocation" [minColWidth]="minColWidth" [colCount]="colCount" [width]="width" -->
          <dxi-item dataField="idAziendaTipoProcedimento.descrizioneTipoProcedimento" editorType="dxTextArea" [label]="{text: 'Descrizione'}" [editorOptions]="{ height:70,disabled: true }"></dxi-item>
          <dxi-item dataField="idAziendaTipoProcedimento.idTipoProcedimento.modoApertura" [label]="{text: 'Modo apertura'}" [editorOptions]="{ disabled: true }"></dxi-item>
          <dxi-item dataField="idAziendaTipoProcedimento.idTipoProcedimento.normaRiferimento" [label]="{text: 'Norma di riferimento'}" [editorOptions]="{ disabled: true }"></dxi-item>
          <dxi-item dataField="idAziendaTipoProcedimento.idTitolo.nomeTitolo" [label]="{text: 'Classificazione'}" [editorOptions]="{ disabled: true }"></dxi-item>
          <dxi-item dataField="idAziendaTipoProcedimento.durataMassimaSospensione" [label]="{text: 'Durata massima sospensione'}" [editorOptions]="{ disabled: true }" ></dxi-item>
          <dxi-item dataField="dataInizio" [label]="{text: 'Valido dal'}" editorType="dxDateBox" [editorOptions]="{ disabled: campiEditabiliDisabilitati, displayFormat: 'dd/MM/yyyy' }" ></dxi-item>
          <dxi-item dataField="dataFine" [label]="{text: 'Al'}" editorType="dxDateBox" [editorOptions]="{ disabled: campiEditabiliDisabilitati, displayFormat: 'dd/MM/yyyy', 
              min: procedimento.dataInizio, dateOutOfRangeMessage: 'Il valore è fuori dall\'intervallo'}"></dxi-item>
          <dxi-item dataField="idTitolarePotereSostitutivo" [label]="{text: 'Titolare potere sostitutivo'}" editorType="dxLookup" [editorOptions]="{ 
            disabled: campiEditabiliDisabilitati,
            dataSource: dataSourceUtente, 
            displayExpr: 'descrizione',
            closeOnOutsideClick: true, 
            showPopupTitle: false, 
            showCancelButton: false,
            placeholder: 'Seleziona una voce...', 
            searchPlaceholder: 'Cerca...',
            valueExpr: 'this'
          }"></dxi-item>
          <dxi-item dataField="modalitaInfo" [label]="{text: 'Modalità informativa'}" [editorOptions]="{ disabled: campiEditabiliDisabilitati }"></dxi-item>
          <dxi-item dataField="descrizioneAtti" [label]="{text: 'Atti da allegare'}" editorType="dxTextArea" [editorOptions]="{ height:70, disabled: campiEditabiliDisabilitati }"></dxi-item>
        </dx-form>
        <span *ngIf="!formVisible"><h2 class="no-procedimento">Nessun procedimento associato alla struttura</h2></span>
      </div>
    </dxi-item>

    <dxi-item class="left-side-bar item">
      <div style="padding-left:10%">
        <dxi-location [row]="1" [col]="0" screen="lg"></dxi-location>
          <dx-button class="padding-button allinea-a-sinistra" (onClick)="showPopup()" text="Associa a strutture" hint="Associa a strutture"></dx-button>
          <strutture-tree #treeView [idAzienda]=idAziendaFront [nodesToCheckSelectedStatus]= "nodeInvolved" [popupVisible]="popupVisible" 
                                    [idAziendaTipoProcedimento]=idAziendaTipoProcedimentoFront [readOnly]="true" [enableCheckRecursively]="false"
            (strutturaSelezionata)="selezionaStruttura($event)" ></strutture-tree>
      </div>
    </dxi-item>

    <dxi-item class="right-side-bar item">
      <dxi-location [row]="1" [col]="2" screen="lg"></dxi-location>
      <!-- colonna vuota destra -->
    </dxi-item>

    <dxi-item class="footer item">
      <dxi-location [row]="2" [col]="1"></dxi-location>
      <dx-responsive-box id="responsive-box-buttons" singleColumnScreen="sm" [(screenByWidth)]="screen">
        <dxi-row [ratio]="1"></dxi-row>
        <dxi-col [ratio]="1"></dxi-col>
        <dxi-col [ratio]="1"></dxi-col>
        <!-- <dxi-item>      
          <dxi-location [row]="0" [col]="0"></dxi-location>
          <dx-button class="padding-button" (onClick)="sbloccaCampiEditabili()" text="{{ testoBottone }}" [disabled]="!abilitaSalva" hint="Modifica i campi"></dx-button>
        </dxi-item> -->
        <dxi-item>      
            <dxi-location [row]="0" [col]="0"></dxi-location>
            <dx-button class="padding-button" [visible]=formVisible (onClick)="bottoneSalvaProcedimento(true)" text="{{ testoBottone }}" hint="Salva i campi"></dx-button>
          </dxi-item>
        <dxi-item>      
          <dxi-location [row]="0" [col]="1"></dxi-location>
            <dx-button class="padding-button" [visible]=formVisible (onClick)="bottoneAnnulla()" text="Annulla" hint="Annulla le modifiche"></dx-button>
        </dxi-item>
      </dx-responsive-box>
      </dxi-item>
  </dx-responsive-box>
</div>


<dx-popup
class="popup"
[width]="600"
[height]="730"
[showTitle]="true"
title="Associa a strutture"
[dragEnabled]="false"
[closeOnOutsideClick]="false"
[(visible)]="popupVisible">
<div *dxTemplate="let data of 'content'">
  <popup-struttura-tipi-procedimento [readOnly]="false" 
                                     [enableCheckRecursively]="false" 
                                     [aziendaTipoProcedimentoObj] = "dataFromAziendaTipiProcedimentoComponent" 
                                     (refreshAfterChange) = "refreshTreeView($event)">
  </popup-struttura-tipi-procedimento>


</div>
</dx-popup>