<div class="container-fluid">
  <div class="row">
    <div class="col">
    </div>
    <div class="col-8 center-text">
      <h3>
        <span class="header-font">Tipo procedimento:</span>
        <i>{{headerTipoProcedimento}}</i>
      </h3>
      <h3>
        <span class="header-font">Azienda:</span>
        <i>{{headerAzienda}}</i>
      </h3>
      <h3>
        <span class="header-font">Struttura:</span>
        <i>{{headerStruttura}}</i>
      </h3>
    </div>
    <div class="col">
    </div>
  </div>

  <div class="row">
    <div class="col-3">
      <dx-button class="padding-button allinea-a-sinistra" (onClick)="showPopup()" text="Associa a strutture" hint="Associa a strutture"></dx-button>
      <strutture-tree #treeView [idAzienda]=idAziendaFront [nodesToCheckSelectedStatus]="nodeInvolved" [popupVisible]="popupVisible"
        [idAziendaTipoProcedimento]=idAziendaTipoProcedimentoFront [readOnly]="true" [enableCheckRecursively]="false" (strutturaSelezionata)="selezionaStruttura($event)"></strutture-tree>
    </div>

    <div class="col-8" id="center-div">
      <dx-form id="form" #myform [(formData)]="procedimento" [visible]="formVisible">
        <dxi-item dataField="idAziendaTipoProcedimento.descrizioneTipoProcedimento" editorType="dxTextArea" [label]="{text: 'Descrizione'}"
          [editorOptions]="{ height:70,disabled: true }"></dxi-item>
        <dxi-item dataField="idAziendaTipoProcedimento.idTipoProcedimento.modoApertura" [label]="{text: 'Modo apertura'}" [editorOptions]="{ disabled: true }"></dxi-item>
        <dxi-item dataField="idAziendaTipoProcedimento.idTipoProcedimento.normaRiferimento" [label]="{text: 'Norma di riferimento'}"
          [editorOptions]="{ disabled: true }"></dxi-item>
        <dxi-item dataField="idAziendaTipoProcedimento.idTitolo.nomeTitolo" [label]="{text: 'Classificazione'}" [editorOptions]="{ disabled: true }"></dxi-item>
        <dxi-item dataField="idAziendaTipoProcedimento.durataMassimaSospensione" [label]="{text: 'Durata massima sospensione'}" [editorOptions]="{ disabled: true }"></dxi-item>
        <dxi-item dataField="dataInizio" [label]="{text: 'Valido dal'}" editorType="dxDateBox" [editorOptions]="{ disabled: campiEditabiliDisabilitati, displayFormat: 'dd/MM/yyyy' }"></dxi-item>
        <dxi-item dataField="dataFine" [label]="{text: 'Al'}" editorType="dxDateBox" [editorOptions]="{ disabled: campiEditabiliDisabilitati, displayFormat: 'dd/MM/yyyy', 
              min: procedimento.dataInizio, dateOutOfRangeMessage: 'Il valore è fuori dall\'intervallo'}"></dxi-item>
        <dxi-item dataField="idTitolarePotereSostitutivo" [label]="{text: 'Titolare potere sostitutivo'}" editorType="dxLookup" [editorOptions]="{ 
            disabled: campiEditabiliDisabilitati,
            dataSource: dataSourceUtente, 
            displayExpr: 'descrizione',
            closeOnOutsideClick: true, 
            showPopupTitle: false, 
            showCancelButton: false,
            placeholder: 'Seleziona una voce...', 
            searchPlaceholder: 'Cerca...',
            valueExpr: 'this'
          }"></dxi-item>
        <dxi-item style="height: 100%" dataField="descrizioneAtti" [label]="{text: 'Atti da allegare'}" editorType="dxTextArea" [editorOptions]="{ disabled: campiEditabiliDisabilitati }"></dxi-item>
        <dxi-item dataField="modalitaInfo" [label]="{text: 'Modalità informativa'}" [editorOptions]="{ disabled: campiEditabiliDisabilitati }"></dxi-item>
        <dxi-item dataField="descrizioneAtti" [label]="{text: 'Atti da allegare'}" editorType="dxTextArea" [editorOptions]="{ height:70, disabled: campiEditabiliDisabilitati }"></dxi-item>
      </dx-form>
      <span *ngIf="!formVisible">
        <h2 class="no-procedimento">Nessun procedimento associato alla struttura</h2>
      </span>
    </div>
    <div class="col"></div>
  </div>

  <div class="row footer item">
    <div class="col"></div>
    <div class="col-2" id="responsive-box-buttons">
      <dx-button class="padding-top" [visible]=formVisible (onClick)="bottoneSalvaProcedimento(true)" text="{{ testoBottone }}"
        hint="Salva i campi"></dx-button>
    </div>
    <div class="col-2">
      <dx-button class="padding-top" [visible]=formVisible (onClick)="bottoneAnnulla()" text="Annulla" hint="Annulla le modifiche"></dx-button>
    </div>
    <div class="col"></div>
  </div>
</div>


<dx-popup class="popup" [width]="600" [height]="730" [showTitle]="true" title="Associa a strutture" [dragEnabled]="false"
  [closeOnOutsideClick]="false" [(visible)]="popupVisible">
  <div *dxTemplate="let data of 'content'">
    <popup-struttura-tipi-procedimento [readOnly]="false" [enableCheckRecursively]="false" [aziendaTipoProcedimentoObj]="dataFromAziendaTipiProcedimentoComponent"
      (refreshAfterChange)="refreshTreeView($event)">
    </popup-struttura-tipi-procedimento>
  </div>
</dx-popup>