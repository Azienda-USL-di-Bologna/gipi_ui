<dx-scroll-view>
    <h4 *ngIf="nomeProcedimento != null" class="titolo-procedimento">Procedimento: {{nomeProcedimento}}</h4>
  
    <br>
  
    <dx-form
      [(formData)]="iterParams"
      scrollingEnabled="true"
      colCount="6"
      class="form-avvia-iter"
      validationGroup="validationAvviaIter"
      [showValidationSummary]="true">
        <dxi-item dataField="dataCreazioneIter" 
          [colSpan]="2" editorType="dxDateBox" [label]="{text: 'Data creazione'}" 
          [editorOptions]="{ disabled: true, displayFormat: 'dd/MM/yyyy' }"
          cssClass="label-wrap-date">
        </dxi-item>
        <dxi-item dataField="dataAvvioIter" 
          [colSpan]="2" editorType="dxDateBox" [label]="{text: 'Data avvio'}" 
          [editorOptions]="{ onValueChanged: setDataMax, disabled: false, max: now, displayFormat: 'dd/MM/yyyy', invalidDateMessage:'La data deve avere il seguente formato: dd/mm/yyyy' }"
          cssClass="label-wrap-date">
          <dxi-validation-rule type="required" message="la data di avvio iter è obbligatoria"></dxi-validation-rule>
        </dxi-item>
        <dxi-item dataField="dataMassimaConclusione" 
          [colSpan]="2" editorType="dxDateBox" [label]="{text: 'Data massima\nconclusione'}" 
          [editorOptions]="{ disabled: true, value: dataMassimaConclusione, displayFormat: 'dd/MM/yyyy' }"
          cssClass="label-wrap-date no-baseline">
        </dxi-item>
      <dxi-item itemType="group" [colCount]="3" [colSpan]="6" cssClass="label-wrap no-baseline" [label]="{text: 'Documento'}">
        <dxi-item dataField="codiceRegistroDocumento" [colSpan]="1" cssClass="fix-bug-dx" [label]="{text: 'Reg.', showColon: false}" [editorOptions]="{ disabled: avviaIterDaDocumento }">
          <dxi-validation-rule type="required" message="il codice registro del documento è obbligatorio"></dxi-validation-rule>
        </dxi-item>
        <dxi-item dataField="numeroDocumento" [colSpan]="1" cssClass="fix-bug-dx" [label]="{text: 'N.', showColon: false}" [editorOptions]="{disabled: avviaIterDaDocumento }">
          <dxi-validation-rule type="required" message="il numero del documento è obbligatorio"></dxi-validation-rule>
        </dxi-item>
        <dxi-item dataField="annoDocumento" editorType="dxNumberBox" [colSpan]="1" cssClass="fix-bug-dx" [label]="{text: 'Anno', showColon: false}" [editorOptions]="{disabled: avviaIterDaDocumento}">
          <dxi-validation-rule type="required" message="l'anno del documento è obbligatorio"></dxi-validation-rule>
        </dxi-item> 
      </dxi-item>
      <dxi-item  #lookup dataField="idUtenteStrutturaResponsabile" [colSpan]="6" cssClass="label-wrap no-baseline lookup-wrap" editorType="dxLookup" 
        [label]="{text: 'Responsabile procedimento\namministrativo'}"
        [editorOptions]="{
          value: idUtenteDefault,
          dataSource: dataSourceUtenti,
          displayExpr: getDescrizioneUtente,
          searchExpr: ['searchString'],
          searchEnabled: true,
          valueExpr: 'id',
          onValueChanged: setUtenteResponsabile,
          hint: descrizioneUtenteResponsabile,
          cancelButtonText: 'Chiudi',
          pageLoadingText: 'Caricamento..',
          placeholder: 'Seleziona..',
          noDataText: 'Nessun dato disponibile',
          closeOnOutsideClick: true,
          searchPlaceholder: 'Cerca',
          showPopupTitle: false,
          onOpened: reloadResponsabile
        }">
        <dxi-validation-rule type="required" message="il responsabile del procedimento amministrativo è obbligatorio"></dxi-validation-rule>
      </dxi-item>
      <dxi-item dataField="promotoreIter" [colSpan]="6" cssClass="label-wrap" [label]="{text: 'Promotore'}" [editorOptions]="{ disabled: true }"></dxi-item>
      
      <!-- PER LA GESTIONE DEL PRECEDENTE -->
      <div *ngIf="precedenteRequired">

      </div>
      
      <dxi-item dataField="oggettoIter" [colSpan]="6" cssClass="label-wrap" editorType="dxTextArea" [label]="{text: 'Oggetto'}" [editorOptions]="{ disabled: false, maxLength: 1024 }">
          <dxi-validation-rule type="required" message="l'oggetto è obbligatorio"></dxi-validation-rule>
      </dxi-item>
      <dxi-item dataField="responsabileAdozioneAttoFinaleDesc" [colSpan]="4" cssClass="label-wrap textbox-position" [label]="{text: 'Responsabile adozione\natto finale'}" [editorOptions]="{ disabled: true }"></dxi-item>
      <dxi-item [colSpan]="2" [label]="{text: 'Fascicolo riservato'}">
        <dx-check-box #check_box_fasc [value]="false" hint="Se selezioni il nome del fascicolo sarà visibile solo a chi avrà permessi sullo stesso" (onValueChanged)="onChangeCheckFascicolo($event)"></dx-check-box>
      </dxi-item>
      <dxi-item dataField="titolarePotereSostitutivoDesc" [colSpan]="4" cssClass="label-wrap" [label]="{text: 'Titolare del potere sostitutivo'}" [editorOptions]="{ disabled: true }"></dxi-item>      
      <dxi-item [colSpan]="2" [label]="{text: 'Invia il CAP al promotore in modo automatico'}">
        <dx-check-box #check_box_acip [value]="defaultAcipValue" hint="Se il promotore ha un indirizzo email verrà inviato in automatico il CAP (Comunicazione Avvio Procedimento)" (onValueChanged)="onChangeCheckAcip($event)"></dx-check-box>
      </dxi-item>
    </dx-form>

    <br>
  
    <div class="buttons">
      <dx-button
        text="Annulla"
        (onClick)="handleEvent('onClickAnnulla',$event)">
      </dx-button>
      <dx-button
        text="Avvia"
        (onClick)="handleEvent('onClickProcedi',$event)" validationGroup="validationAvviaIter">
      </dx-button>
    </div>
</dx-scroll-view>
<dx-load-panel
  #loadPanel
  shadingColor="rgba(191, 191, 191, 0.5)"
  position="{ of: window }"
  [(visible)]="loadingVisible"
  [showIndicator]="true"
  message="Attendere prego..."
  [showPane]="true"
  [shading]="true"
  [closeOnOutsideClick]="false">
</dx-load-panel>