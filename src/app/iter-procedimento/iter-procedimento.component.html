<div class="container-fluid iter-procedimento">
    <!-- Non cancellare. Potrenne tornare utile in futuro 
        <app-buttons-bar (onGenericButtonClick)="onGenericButtonClick($event)" [genericButtons]="genericButtons">
    </app-buttons-bar> -->
    <div class="col header-font">
        <h3>
            <span class="header-font">Struttura procedente:</span>
            <i>{{infoGeneriche.struttura}}</i>
        </h3>
        <h3>
            <span class="header-font">Tipo procedimento:</span>
            <i>{{infoGeneriche.tipoProcedimento}}</i>
        </h3>

        <!-- <div>
            <dx-button [text]="'Procedi'" (onClick)="passaggioDiFase()"></dx-button>
        </div>
        <div>
            <dx-button [text]="nomeBottoneSospensione()" (onClick)="sospensioneIter()"></dx-button>
        </div> -->

    </div>

    <div class="row">
        <div class="col-lg-6 col-md-12">
            <dx-form id="form" [colCount]="1" [formData]="iter"    #myForm1> <!-- [screenByWidth]="screen"-->
                <dxi-item itemType="group" [colCount]="6" [caption]="datiGenerali" [cssClass]="classeDiHighlight">
                    <!-- <dxi-item [colSpan]="2" dataField="id" [editorOptions]="{ disabled: true }"></dxi-item> -->

                    <dxi-item [colSpan]="6" dataField="oggetto" editorType="dxTextArea" [editorOptions]="{ height: 70, disabled: true }"></dxi-item>

                    <dxi-item [colSpan]="6" dataField="procedimentoCache.nomeVisualResponsabileProcedimento" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Resp. procedimento"></dxo-label>
                    </dxi-item>
                    <dxi-item [colSpan]="6" dataField="procedimentoCache.nomeVisualResponsabileAttoFinale" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Resp. adozione atto finale"></dxo-label>
                    </dxi-item>
                    <dxi-item [colSpan]="6" dataField="procedimentoCache.nomeVisualTitolare" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Tit. potere sostitutivo"></dxo-label>
                    </dxi-item>

                    <!-- <dxi-item [colSpan]="4" dataField="promotore" [editorOptions]="{ disabled: true }"></dxi-item> -->

                        <dxi-item [colSpan]="1" dataField="presenzaControinteressati" editorType="dxCheckBox" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Presenza controinteressati"></dxo-label>
                        </dxi-item>

                        <dxi-item [colSpan]="5">
                            <button class="btn button-azioni" id="note" type="button" (click)="updateNoteControInteressati()">Note <img class="icon-margin" src="assets/images/clipboard-with-pencil.png"></button>
                            <!-- <dx-button text="Note controinteressati" type="default" (onClick)="updateNoteControInteressati()"></dx-button> -->
                        </dxi-item>

                    <!-- <dxi-item [colSpan]="2" dataField="idFase.nome" [editorOptions]="{ disabled: true }">
                    <dxo-label text="Fase corrente"></dxo-label>
                </dxi-item> -->

                    <!-- <dxi-item [colSpan]="2" dataField="stato" [editorOptions]="{ disabled: true }"></dxi-item> -->
                    <!-- <dxi-item [colSpan]="4" dataField="esito" cssClass="fix-bug-dx" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Esito"></dxo-label>
                    </dxi-item> -->
                    <dxi-item dataField="esito" [colSpan]="5" cssClass="fix-bug-dx" editorType="dxLookup" [label]="{text: 'Esito'}" [editorOptions]="{ 
                        disabled: true,
                        items: arrayEsiti,
                        displayExpr: 'descrizione',
                        displayValue: 'codice',
                        valueExpr: 'codice',
                        selectionMode: 'single',
                        showPopupTitle: false,
                        closeOnOutsideClick: true,
                        showCancelButton: false,
                        placeholder: '-',
                        searchEnabled: false
                      }"></dxi-item>

                    <dxi-item [colSpan]="1">
                        <button class="btn button-azioni" id="motivazione" type="button" (click)="updateEsitoMotivazione()" [disabled]="inSolaLettura()">Motivazione</button>
                        <!-- <dx-button text="Motivazione" type="default" (onClick)="updateEsitoMotivazione()"></dx-button> -->
                    </dxi-item>
                    <dxi-item [colSpan]="6" dataField="esitoMotivazione"[label]="{text: 'Motivazione esito'}" editorType="dxTextArea" [editorOptions]="{ disabled: true, height: 55 }" >
                    </dxi-item>
                </dxi-item>

                <dxi-item [colCount]="1" itemType="group" caption="Dati temporali">
                    <dxi-item [colSpan]="1" dataField="dataAvvio" [label]="{text: 'Data avvio iter'}" editorType="dxDateBox" [editorOptions]="{ disabled: true, displayFormat: 'dd/MM/yyyy' }"></dxi-item>
                    
                    <dxi-item itemType="group" [colCount]="10" caption="Durata" cssClass="meVedi">
                        <dxi-item [colSpan]="colCountGroup" dataField="procedimentoCache.durataMassimaProcedimento" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Durata prevista (gg)"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup" dataField="giorniDurataTrascorsi" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Giorni trascorsi"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup" dataField="derogaDurata" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Deroga durata (gg)"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup - 1" dataField="motivoDerogaDurata" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Motivazione deroga"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="1">
                            <button class="btn button-azioni" type="button" (click)="updateMotivazioneDeroga()"><img class="icon-margin" src="assets/images/clipboard-with-pencil.png"></button>
                        </dxi-item>
                    </dxi-item>

                    <dxi-item itemType="group" [colCount]="10" caption="Sospensioni" cssClass="meVedi">
                        <dxi-item [colSpan]="colCountGroup" dataField="procedimentoCache.durataMassimaSospensione" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Massima sospensione (gg)"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup" dataField="giorniSospensioneTrascorsi" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Giorni sospensione trascorsi"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup" dataField="derogaSospensione" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Deroga sospensione (gg)"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup - 1" dataField="motivoDerogaSospensione" [editorOptions]="{ disabled: true}">
                            <dxo-label text="Motivazione deroga"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="1">
                            <button class="btn button-azioni" type="button" (click)="updateMotivazioneSospensione()"><img class="icon-margin" src="assets/images/clipboard-with-pencil.png"></button>
                        </dxi-item>
                    </dxi-item>

                    <dxi-item itemType="group" [colCount]="10" caption="Chiusura" cssClass="meVedi">
                        <dxi-item [colSpan]="colCountGroup" dataField="dataChiusuraPrevista" editorType="dxDateBox" [editorOptions]="{ disabled: true, displayFormat: 'dd/MM/yyyy' }">
                            <dxo-label text="Data chiusura prevista"></dxo-label>
                        </dxi-item>
                        <dxi-item [colSpan]="colCountGroup" dataField="dataChiusura" editorType="dxDateBox" [editorOptions]="{ disabled: true, displayFormat: 'dd/MM/yyyy' }">
                            <dxo-label text="Data chiusura effettiva"></dxo-label>
                        </dxi-item>
                    </dxi-item>
                </dxi-item>

                <dxi-item itemType="group" caption="Dati di archivio">
                    <dxi-item dataField="idIterPrecedente.numero" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Coll. precedente"></dxo-label>
                    </dxi-item>
                    <dxi-item dataField="modalitaCollegamentoPrecedente" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Motivo collegamento"></dxo-label>
                    </dxi-item>
                    <dxi-item dataField="idFascicolo" [editorOptions]="{ disabled: true }">
                        <dxo-label text="Fascicolo dell'iter"></dxo-label>
                    </dxi-item>
                    <dxi-item dataField="idTitolo" [label]="{text: 'Classificazione'}" editorType="dxLookup" [editorOptions]="{
                        disabled: true,
                        dataSource: dataSourceClassificazione,
                        displayExpr: customDisplayExprClassificazione,
                        closeOnOutsideClick: true,
                        showPopupTitle: false,
                        showCancelButton: false,
                        placeholder: 'Seleziona una voce...',
                        searchPlaceholder: 'Cerca...',
                        valueExpr: 'this'
                        }"></dxi-item> 
                   <!--  <dxi-item dataField="nomeTitolo" [editorOptions]="{ disabled: true }"></dxi-item> -->
                </dxi-item>
            </dx-form>
        </div>

        <div class="col-lg-6 col-md-12">
            <!-- Non cancellare. Torneremo ad utilizzarlo 
                <div class="whitePanel mb-3">
                <app-sequenza-delle-fasi [daPadre]="perFigliParteDestra"></app-sequenza-delle-fasi>
            </div> -->
            <div class="griginoPanel mb-3 "> <!-- fixHeight -->
                <app-cronologia-eventi [daPadre]="perFigliParteDestra"></app-cronologia-eventi>
            </div>
            <!-- Non cancellare. Torneremo ad utilizzarlo 
                <div class="whitePanel fixHeight">
                <documenti-iter [daPadre]="perFigliParteDestra"></documenti-iter>
            </div> -->
        </div>
    </div>


    <div class="col footerDiv">
<!-- COMMENTATO NELLO SPRINT "SOCCIA CHE ZAGNO" (Seriamente: a che servono??) 
        <dx-button [text]="'Annulla'" [type]="'normal'"></dx-button>

        <dx-button [text]="'Conferma'" [type]="'normal'"></dx-button> -->
        <div>        </div>
    </div>



</div>

<dx-popup class="popup" [width]="500" [height]="310" [showTitle]="true" [title]="popupData.title" [dragEnabled]="false" [closeOnOutsideClick]="true"
    [(visible)]="popupData.visible">
    <div *dxTemplate="let data of 'content'">
        <div class="box-margin" *ngIf="popupData.field === 'noteControInteressati'">
            <dx-check-box
                text="Presenza controinteressati"
                hint="Abilita/Disabilita la presenza dei controinteressati"
                [(value)]="popupData.checkInteressati"
                [disabled]="inSolaLettura()">
            </dx-check-box>
        </div>
        <dx-text-area [height]="150" [(value)]="popupData.fieldValue" [disabled]="disableAreaTextNote()"></dx-text-area>
        <div class="wrapperPulsantiPopup">
            <dx-button class="button-css" text="OK" (click)="updateIter($event)" type="default"></dx-button>
            <span class="btn-space"></span>
            <dx-button class="button-css" text="Annulla" type="normal" (click)="closePopupNote()"></dx-button>
        </div>
    </div>
</dx-popup>

<dx-popup class="popup" [width]="500" [height]="335" [showTitle]="true" [title]="popupDatiTemporali.title" [dragEnabled]="false" [closeOnOutsideClick]="true"
    [(visible)]="popupDatiTemporali.visible">
    <div *dxTemplate="let data of 'content'">
        
        <dx-form #formPopupDatiTemporali
            [(formData)]="popupDatiTemporali" validationGroup="validaDatiTemporali" [showValidationSummary]="true">

            <dxi-item dataField="fieldDays" editorType="dxNumberBox" [editorOptions]="{ disabled: false }">
                <dxo-label text="Deroga {{popupDatiTemporali.action}} (gg)"></dxo-label>
                <dxi-validation-rule type="required" message="Il numero di giorni di deroga è obbligatorio"></dxi-validation-rule>
            </dxi-item>
            
            <dxi-item dataField="fieldMotivation"[label]="{text: 'Motivazione'}" editorType="dxTextArea" [editorOptions]="{ disabled: false, height: 120 }" >
                <dxi-validation-rule type="required" message="La motivazione è obbligatoria"></dxi-validation-rule>
            </dxi-item>
        </dx-form>
        <dx-validation-summary id="summary"></dx-validation-summary>
        <div class="wrapperPulsantiPopup">
            <dx-button class="button-css" text="OK" (onClick)="updateIter($event)" [validationGroup]="'validaDatiTemporali'"></dx-button>
            <span class="btn-space"></span>
            <dx-button class="button-css" text="Annulla" type="normal" (onClick)="closePopupDeroga($event)"></dx-button>
        </div>
    </div>
</dx-popup>


<dx-popup class="passaggioFase" [width]="700" [showTitle]="true" [title]="popupData.title" [dragEnabled]="false" [closeOnOutsideClick]="true"
    [(visible)]="passaggioDiFaseVisible">
    <div *dxTemplate="let data of 'content'">
        <app-passaggio-di-fase *ngIf="passaggioDiFaseVisible" [idIter]="idIter" [isOpenedAsPopup]="true" (out)="receiveMessage($event)"></app-passaggio-di-fase>
    </div>
</dx-popup>

<dx-popup class="sospensionePopup" [width]="700" [showTitle]="true" [title]="popupData.title" [dragEnabled]="false" [closeOnOutsideClick]="true"
    [(visible)]="sospensioneIterVisible">
    <div *dxTemplate="let data of 'content'">
        <app-cambio-di-stato-box *ngIf="sospensioneIterVisible" [sospensioneParams]="sospensioneParams" [userInfo]="userInfo" [isOpenedAsPopup]="true" (out)="receiveMessageFromSospensione($event)"></app-cambio-di-stato-box>
        <!-- <sospensione-iter [params]="paramsPerSospensione" (messageEvent)="receiveMessageFromSospensione($event)"></sospensione-iter> -->
    </div>
</dx-popup>